name: Audit

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  audit:
    runs-on: ubuntu-20.04
    container: golang:1.20.5
    steps:
    - uses: actions/checkout@v2

    - name: Verify dependencies
      run: make audit/verify

    - name: Run gofmt
      run: make audit/format

    - name: Build
      run: make build

    - name: Run go vet
      run: make audit/vet

    - name: Run staticcheck
      run: make audit/staticcheck

    - name: Run vulncheck
      run: make audit/vulncheck

    - name: Run golint
      run: make audit/lint

    - name: Run tests
      run:  make audit/race
